{% extends 'base.html' %}
{% load static %}

{% block meta %}
<title>Login - B-Athletica Product</title>
{% endblock meta %}

{% block content %}
<div class="relative w-full min-h-screen flex items-center justify-center p-8 bg-cover bg-center"
style="background-color: #ffffff;">
  <div class="max-w-md w-full">
    <div class="relative rounded-2xl p-[2px] bg-transparent shadow-[0_0_25px_rgba(255,255,255,0.05)]">
      <div class="backdrop-blur-3xl rounded-md p-8 sm:p-10 text-white form-style"
           style="background: linear-gradient(145deg, #1c57a0, #0a1e73, #502e8a); background-blend-mode: overlay;">
        <div class="text-center mb-4 mt-[-10px]">
          <h1 class="text-4xl sm:text-5xl font-extrabold text-white mb-4 tracking-wide drop-shadow-[0_0_8px_rgba(255,255,255,0.4)]">
            Sign In
          </h1>        
          <p class="text-white-500">Welcome back to B-Athletica</p>
        </div>

        <!-- Error form default Django boleh tetap ada -->
        {% if form.non_field_errors %}
          <div class="mb-6">
            {% for error in form.non_field_errors %}
              <div class="px-4 py-3 rounded-md text-sm border bg-red-50 border-red-200 text-red-700">
                {{ error }}
              </div>
            {% endfor %}
          </div>
        {% endif %}

        <form method="POST" action="" class="space-y-6">
          {% csrf_token %}
          <div>
            <label for="username" class="block text-sm font-medium text-white-700 mb-2">Username</label>
            <input id="username" name="username" type="text" required class="w-full px-4 py-3 border border-gray-300 rounded-md focus:outline-none focus:border-blue-500 transition-colors" placeholder="Enter your username">
          </div>

          <div>
            <label for="password" class="block text-sm font-medium text-white-700 mb-2">Password</label>
            <input id="password" name="password" type="password" required class="w-full px-4 py-3 border border-gray-300 rounded-md focus:outline-none focus:border-blue-500 transition-colors" placeholder="Enter your password">
          </div>

          <button type="submit" class="w-full bg-blue-600 text-white font-medium py-3 px-4 rounded-md hover:bg-blue-700 transition-colors">
            Sign In
          </button>
        </form>

        <div class="mt-6 text-center pt-6 border-t border-white-200">
          <p class="text-white-700 text-medium">
            Don't have an account? 
            <a href="{% url 'main:register' %}" style="color:#99b4ff; text-shadow:0 0 10px rgb(27, 25, 189); font-weight:600;" class="hover:text-blue transition-colors">
              Register
            </a>
          </p>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ================== AJAX LOGIN (BARU) ================== -->
<script>
  (function() {
    const form = document.querySelector('form[method="POST"]');
    if (!form) return;

    form.addEventListener('submit', async (e) => {
      e.preventDefault(); // cegah submit normal
      const res = await fetch("{% url 'main:login_ajax' %}", {
        method: 'POST',
        headers: { 'X-CSRFToken': CSRF_TOKEN },
        body: new FormData(form),
      });

      if (res.ok) {
        showToast('Welcome!', 'Login success', 'success');
        // redirect ke halaman utama
        window.location.href = "{% url 'main:show_main' %}";
      } else {
        const data = await res.json().catch(()=>({}));
        showToast('Login failed', (data.detail || 'Invalid credentials'), 'error');
      }
    });
  })();
</script>
<!-- ======================================================= -->

{% endblock content %}